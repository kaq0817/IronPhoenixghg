{% comment %}
  Optimized Product Card
  - Title limited to 5 words
  - Description from meta or first paragraph
  - Structured <h3> blocks
  - Under-the-fold metafield images (photo1â€“photo3)
  - Mobile-first performance
{% endcomment %}

{%- if card_product and card_product != empty -%}
  {%- liquid
    assign title_words = card_product.title | split: ' ' | slice: 0, 5 | join: ' '
    assign product_description = card_product.metafields.global.description_tag
    if product_description == blank
      assign product_description = card_product.metafields.custom.meta_description | default: card_product.description | split: '</p>' | first | strip_html | strip_newlines
    endif
  -%}

  <div class="card-wrapper product-card-wrapper underline-links-hover">
    <div class="card card--{{ settings.card_style }} card--media card--extend-height">

      {%- if card_product.featured_media -%}
        <div class="card__media">
          <div class="media media--transparent">
            <img
              src="{{ card_product.featured_media | image_url: width: 600 }}"
              alt="{{ card_product.featured_media.alt | escape }}"
              loading="lazy"
              width="{{ card_product.featured_media.width }}"
              height="{{ card_product.featured_media.height }}"
            >
          </div>
        </div>
      {%- endif -%}

      <div class="card__content">
        <h3 class="card__heading h2">
          <a href="{{ card_product.url }}">
            {{ title_words }}
          </a>
        </h3>

        {% render 'badge-volume', product: card_product %}

        {% render 'price', product: card_product %}

        {% if quick_add == 'standard' %}
          {% render 'quick-add-button', product: card_product %}
        {% endif %}
      </div>

    </div>
  </div>
{%- else -%}
  <div class="card-wrapper product-card-wrapper placeholder">
    {{ 'product-apparel-2' | placeholder_svg_tag: 'placeholder-svg' }}
  </div>
{%- endif -%}
